## 并发扣数

-  sync 锁资源
-  mysql： update where num>0 and id = ?  乐观锁 
- redis decr \ incr 
- 线程任务队列 将并发 压平 顺序执行

## 双写不一致

### redis 更新成功，mysql 失败

1. mysqsl 重试
2. redis 再改回去

### mysql 更新成功，redis 失败

#### 延迟双删

1. 删除 redis 让 击穿的key 查询数据库最新的
2. 一秒后再次删除redis的防治上一次的还不是最新的